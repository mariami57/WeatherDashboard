{% extends "common/base.html" %}
{% load static %}

{% block content %}
    <div>
    <img class="logo" src="{% static 'images/wt_logo.png' %}" alt="website-logo"/>
    </div>
    <div class="content-container">
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="SEARCH CITY..."/>
            <ul id="search-results"></ul>
        </div>
    </div>
<script>
const input = document.getElementById("search-input");
const resultsList = document.getElementById("search-results");


input.addEventListener("input", function () {
    const query = this.value.trim();

    if (query.length < 2) {
        resultsList.innerHTML = "";
        return;
    }

    fetch(`/weather/api/cities/?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            resultsList.innerHTML = "";
            data.forEach(city => {
                const li = document.createElement("li");
                li.textContent = city.display;

                li.addEventListener("click", () => {
                    input.value = city.display;
                    resultsList.innerHTML = "";
                    fetchWeather(city.display);
                });

                resultsList.appendChild(li);
            });
        });
});


input.addEventListener("keypress", function (e) {
    if (e.key === "Enter") {
        fetchWeather(this.value);
    }
});


function fetchWeather(city) {
    fetch(`/weather/api/weather/?city=${city}`)
        .then(response => response.json())
        .then(data => {
            resultsList.innerHTML = "";

            if (data.error) {
                resultsList.innerHTML = `<li>${data.error}</li>`;
            } else {
                resultsList.innerHTML = `
                    <li>
                        ${data.name} - ${data.main.temp}Â°C, ${data.weather[0].description}
                    </li>
                `;
            }
        });
}
</script>
{% endblock %}